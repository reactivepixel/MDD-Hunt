"use strict";angular.module("gravityApp",["ngRoute","firebase"]).config(["$routeProvider",function(a){a.when("/standard",{templateUrl:"views/main.tpl",controller:"MainCtrl"}).when("/",{templateUrl:"views/login.tpl",controller:"CtrlUser"}).otherwise({redirectTo:"/"})}]),angular.module("gravityApp").factory("FireBind",["$firebase",function(a){var b=new Firebase("https://gravityapp.firebaseio.com");return a(b)}]).factory("FireLog",["$firebaseSimpleLogin",function(a){var b=new Firebase("https://gravityapp.firebaseio.com");return a(b)}]),angular.module("gravityApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gravityApp").controller("CtrlUser",["$scope","FireBind","$firebaseSimpleLogin","$http","$timeout","FireLog","$rootScope",function(a,b,c,d,e,f,g){a.instructions="Logging into Github is required to continue down this rabbit hole.",b.$bind(a,"info"),g.$on("$firebaseSimpleLogin:login",function(){a.processUserLogin({user:f.user})}),a.createEvent=function(){!a.info.events,console.log(a.newEvent)},a.beaconExtinguish=function(){a.forceUnlock()},a.activateBeacon=function(){a.info.githubUsers[a.user.id].beaconStatus=!0,a.falseBeacons=0;for(var b in a.info.githubUsers)a.info.githubUsers[b].beaconStatus||a.falseBeacons++;var c=a.user.id;e(function(){a.info.githubUsers[c].beaconStatus=!1},3e3),a.findLoc({userID:c})},a.findLoc=function(b){console.log("setup"),navigator.geolocation?a.GeoLoc=navigator.geolocation.getCurrentPosition(function(c){console.log("args.userID",b.userID),a.info.githubUsers[b.userID].geoLoc=c,console.log("setting data",c),0===a.falseBeacons&&a.proximityCheck()},function(b){a.error="Geolocation Failure. Make certain you this service is not disabled within your settings. Please refresh your browser.",console.log("error",b)}):(console.log("not supported"),a.error="Geolocation Failure")},a.proximityCheck=function(){var b=.01;a.info.proxFailure=!1;for(var c in a.info.githubUsers){var d=a.info.githubUsers[c];if(!d.geoLoc){a.info.proxFailure=!0;break}for(var e in a.info.githubUsers){var f=a.info.githubUsers[e],g=a.distance(d.geoLoc.coords.longitude,d.geoLoc.coords.latitude,f.geoLoc.coords.longitude,f.geoLoc.coords.latitude);console.log("diff",g),b>=g&&0!==g&&a.proxFail()}}return console.log("$scope.info.proxFailure",a.info.proxFailure,!a.info.proxFailure),a.info.proxFailure||a.forceUnlock(),a.info.proxFailure},a.proxFail=function(){a.info.proxFailure=!0},a.distance=function(a,b,c,d){"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180});var e=6371,f=(d-b).toRad(),g=(c-a).toRad(),h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(b.toRad())*Math.cos(d.toRad())*Math.sin(g/2)*Math.sin(g/2),i=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),j=e*i;return j},a.processUserLogin=function(b){"github"===b.user.provider?(b.user.beaconStatus=!1,a.user=b.user,a.findLoc({userID:a.user.id}),a.instructions="Complex interfaces without instructions can be annoying. Try and lead your users with affordiances... visual clues."):"facebook"===b.user.provider&&(a.user=b.user,a.user.picture="https://graph.facebook.com/"+b.user.id+"/picture",a.addUser(b.user))},a.githubLogin=function(){f.$login("github",{scope:"user,repo"}).then(function(b){a.addGithubUser(b),a.processUserLogin({user:b})},function(a){console.log("Error Logging in:",a)})},a.facebookLogin=function(){f.$login("facebook",{scope:"email,user_photos,rsvp_event,create_event"}).then(function(b){a.processUserLogin({user:b})},function(a){console.log("Error Logging in:",a)})},a.attendFacebookEvent=function(a){var b="https://graph.facebook.com/"+a.eventID+"/attending/?callback=JSON_CALLBACK&access_token="+a.accessToken;d({method:"post",url:b}).success(function(a,b){console.log("success",a,b)}).error(function(a,b){console.log("error",a,b)})},a.facebookLogout=function(){f.$logout(),delete a.info.githubUsers[a.user.id],delete a.user},a.addUser=function(b){void 0===a.info.users&&(a.info.users=[]),a.info.users[b.id]=b},a.addGithubUser=function(b){void 0===a.info.githubUsers&&(a.info.githubUsers=[]),a.info.githubUsers[b.id]=b},a.forceUnlock=function(){a.info.lockbox.lockedStatus=!1},a.forceLock=function(){a.info.lockbox.lockedStatus=!0}}]);